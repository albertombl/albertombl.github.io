

    <!doctype html>
    <html lang="es">
    <head>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      <title>ML5 02 路 p5 + Dibujo</title>

      <!-- p5 -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.9.0/p5.min.js"></script>

      <!-- ml5 -->
      <script src="https://unpkg.com/ml5@0.12.2/dist/ml5.min.js"></script>
    </head>

    <body>

    <h2>ML5 02 路 Detecci贸n y dibujo con p5</h2>
    <p> Sustituye este texto por una explicaci贸n detallada del funcionamiento del script. </p>

    <script>

    let video;
    let detector;
    let detections = [];

    const UMBRAL = 0.60;

    function setup() {
      createCanvas(640, 480);

      video = createCapture(VIDEO);
      video.size(640, 480);
      video.hide();

      detector = ml5.objectDetector("cocossd", modeloListo);
    }

    function modeloListo() {
      detector.detect(video, gotResults);
    }

    function gotResults(error, results) {
      if (error) {
        console.log(error);
        return;
      }

      detections = results;
      detector.detect(video, gotResults);
    }

    function draw() {

      image(video, 0, 0);

      let mejor = null;

      for (let i = 0; i < detections.length; i++) {
        let d = detections[i];

        if (mejor == null || d.confidence > mejor.confidence) {
          mejor = d;
        }

        noFill();
        stroke(0);
        rect(d.x, d.y, d.width, d.height);
      }

      if (mejor && mejor.confidence >= UMBRAL) {

        let cx = mejor.x + mejor.width / 2;
        let cy = mejor.y + mejor.height / 2;
        let s = min(mejor.width, mejor.height) / 120;

        if (mejor.label === "person") {
          dibujarPersona(cx, cy, s);
        } else if (mejor.label === "cell phone") {
          dibujarMovil(cx, cy, s);
        } else if (mejor.label === "bottle") {
          dibujarBotella(cx, cy, s);
        } else {
          dibujarDesconocido(cx, cy, s);
        }
      }
    }

    // -------------------
    // FUNCIONES DE DIBUJO
    // -------------------

    function dibujarPersona(cx, cy, s) {
      push();
      translate(cx, cy);
      scale(s);

      noFill();
      stroke(0);

      circle(0, -40, 36);
      rect(-12, -22, 24, 40);

      line(-28, -10, 28, -10);
      line(-8, 18, -22, 48);
      line(8, 18, 22, 48);

      pop();
    }

    function dibujarMovil(cx, cy, s) {
      push();
      translate(cx, cy);
      scale(s);

      noFill();
      stroke(0);

      rect(-18, -35, 36, 70);
      rect(-14, -28, 28, 52);
      circle(0, 30, 6);

      pop();
    }

    function dibujarBotella(cx, cy, s) {
      push();
      translate(cx, cy);
      scale(s);

      noFill();
      stroke(0);

      rect(-14, -30, 28, 60);
      rect(-8, -45, 16, 15);
      rect(-10, -52, 20, 7);

      pop();
    }

    function dibujarDesconocido(cx, cy, s) {
      push();
      translate(cx, cy);
      scale(s);

      textSize(48);
      text("?", -12, 18);

      pop();
    }

    </script>
    </body>
    </html>
